<!doctype html><meta charset="utf-8">
<script>
    (async ()=>{
        /* сразу пытаемся silent cookie → main никогда не увидит этого окна */
        const s = await fetch('/auth/silent',{credentials:'include'});
        if(s.ok){
            const {token}=await s.json();
            location = `myapp://auth#${encodeURIComponent(token)}`;
            return;
        }
    })();
</script>

<h3>Sign in</h3>
<form onsubmit="event.preventDefault();go()">
    <input id="email"  placeholder="demo@example.com"><br>
    <input id="pwd" type="password" value="pass"><br>
    <button>Login</button>
</form>
<script>
    async function go(){
        const r = await fetch('/auth/login',{
            method:'POST', credentials:'include',
            headers:{'Content-Type':'application/json'},
            body: JSON.stringify({email:email.value, password:pwd.value})});
        if(r.ok){
            const {token}=await r.json();
            location=`myapp://auth#${encodeURIComponent(token)}`;
        }else alert('Wrong creds');
    }
</script>
